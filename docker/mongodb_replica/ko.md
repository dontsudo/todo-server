레플리카 세트는 MongoDB에서 중복성과 고가용성을 제공하는 기능입니다.

레플리카 세트는 동일한 데이터 세트를 가진 mongod 프로세스 그룹입니다. 일반적으로 레플리카 세트는 다음과 같은 구성 요소로 이루어집니다:

- 프라이머리(Primary) 노드: 모든 쓰기 요청을 처리합니다.

- 세컨더리(Secondary) 노드: 프라이머리의 오퍼레이션 로그를 복제하고 자신의 데이터에 적용하여 프라이머리 데이터와 동기화됩니다.

- 아비터(Arbiter) 노드: 선거 과정에 참여하지만 데이터는 저장하지 않습니다.

프라이머리 노드에 장애가 발생하면 세컨더리 노드 중 하나가 선거를 시작하여 새로운 프라이머리로 선출될 수 있습니다.

이러한 방식으로 레플리카 세트는 단일 데이터베이스 서버 장애에 대한 내결함성을 제공합니다. 또한 다수의 세컨더리를 사용하여 읽기 요청을 분산할 수 있어 읽기 성능을 향상시킬 수 있습니다.

레플리카 세트는 MongoDB의 모든 프로덕션 배포에 기본이 되는 기술로, 중요도가 높습니다.

---

## 개인적인 궁금증

### Q. 프라이머리 노드에 새로운 데이터가 들어오면 계속해서 세컨더리를 업데이트하는 방식인가?

네, 맞습니다.

레플리카 세트에서 프라이머리 노드가 새로운 쓰기 요청을 받으면 다음 과정을 통해 세컨더리를 업데이트합니다:

1. 프라이머리는 새로운 쓰기 작업을 먼저 자신의 데이터베이스에 반영합니다.
2. 그리고나서 그 변경 사항을 오퍼레이션 로그(oplog)에 기록합니다.
3. 세컨더리 노드들은 주기적으로 프라이머리의 오퍼레이션 로그를 체크합니다.
4. 오퍼레이션 로그에 새로운 업데이트가 있으면 세컨더리들도 자신의 데이터베이스에 그 업데이트를 반영합니다.
5. 이러한 과정을 '복제(Replication)' 라고 하는데, 비동기적으로 이루어집니다.
6. 결과적으로 모든 세컨더리 노드의 데이터는 최终 프라이머리와 일치하게 됩니다.

이러한 비동기 복제 과정을 통해 프라이머리 노드의 새로운 데이터는 결국 모든 세컨더리 노드로 전파되며, 레플리카 세트의 데이터 일치성이 유지됩니다.

### Q. 고가용성만 제공하고 확장성은 제공하지 않는 것처럼 보이는데 맞아? 예를 들어 실제 읽기, 쓰기 연산이 빨라지는 건 아닌 것 같아

네, 맞습니다. MongoDB의 레플리카 세트는 기본적으로 고가용성을 위한 기술로, 확장성 측면의 이점은 제한적입니다.

레플리카 세트의 주요 이점은 다음과 같습니다:

- 고가용성(High Availability): 프라이머리 서버 장애 시 세컨더리가 대체 가능
- 내결함성(Fault Tolerance): 데이터 중복을 통한 복구 능력
- 로컬 읽기: 세컨더리로 읽기 요청 분산 가능

하지만 확장성 측면에서의 이점은 제한적입니다:

- 쓰기 성능 향상 없음: 모든 쓰기는 프라이머리에서 처리
- 읽기 성능 향상은 제한적: 세컨더리로 읽기 요청 분산 가능하지만, 프라이머리보다 느림

즉, 레플리카 세트만으로는 읽기/쓰기 성능이 전반적으로 향상되기는 어렵습니다.

확장성 측면에서 이점이 필요하다면 샤딩 방식을 고려할 수 있습니다.
